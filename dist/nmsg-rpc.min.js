!function(t){function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){var r,n,s,o=this;"undefined"!=typeof window&&(o=window),"undefined"!=typeof self&&(o=self),function(e,o){n=[],r=o,s="function"==typeof r?r.apply(i,n):r,!(void 0!==s&&(t.exports=s)),e.nmsg=e.nmsg||{},e.nmsg.rpc=o()}(o,function(){return e(1)})},function(t,i,e){"use strict";var r=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},n=e(2),s=function(){function t(){this.data=null,this.id=0,this.event="",this.args=[],this.callbacks=[],this.rid=0,this.func=0,this.timeout=t.timeout}return t.getNextId=function(){return t.id=t.id%1e9+1},t.prototype.hasCallbacks=function(){for(var t=0,i=this.args;t<i.length;t++){var e=i[t];if("function"==typeof e)return!0}return!1},t.prototype.isResponse=function(){return!!this.rid},t.id=0,t.timeout=5e3,t}();i.Frame=s;var o=function(t){function i(i,e){void 0===i&&(i=[]),void 0===e&&(e=""),t.call(this),this.id=s.getNextId(),this.event=e,this.args=i}return r(i,t),i.createResponse=function(t,e,r){var n=new i(r);return n.rid=t.id,n.func=e,n},i.prototype.processResponse=function(t){var i=t.func,e=this.args[i];"function"==typeof e&&(this.args[i]=null,e.apply(null,t.args))},i.prototype.serialize=function(){var t={i:this.id};if(this.event&&(t.e=this.event),this.args.length){t.a=[];for(var i=[],e=0;e<this.args.length;e++){var r=this.args[e];"function"==typeof r?(i.push(e),this.callbacks.push(r)):(t.a.push(r),s.timeout!=this.timeout&&(t.t=this.timeout/1e3))}i.length&&(t.c=i)}return this.rid&&(t.r=this.rid,t.f=this.func),this.data=t,this.data},i}(s);i.FrameOutgoing=o;var a=function(t){function i(){t.apply(this,arguments)}return r(i,t),i.prototype.unserialize=function(t,i){if("number"!=typeof t.i)throw Error("Error parsing id");this.id=t.i,this.timeout="number"==typeof t.t?t.t:s.timeout;var e=t.a&&t.a instanceof Array?t.a:[];this.args=[];for(var r=t.c&&t.c instanceof Array?t.c:[],n=0,o=0,a=0;a<e.length+r.length;a++)if(a===r[n]){var h=r[n++];if("number"!=typeof h)throw Error("Invalid callback list");this.args.push(i(this,h))}else this.args.push(e[o++]);if(t.e){if("string"!=typeof t.e)throw Error("Error parsing event");this.event=t.e}else{if("number"!=typeof t.r)throw Error("Error parsing resposne id");if(this.rid=t.r,"number"!=typeof t.f)throw Error("Error parsing response position");this.func=t.f}},i}(s);i.FrameIncoming=a;var h=function(){function t(){this.latency=500,this.frame={},this.timer={},this.onerror=function(){},this.api=null,this.subs={}}return t.prototype.genCallack=function(t,i){var e=this,r=!1;return function(){for(var n=[],s=0;s<arguments.length;s++)n[s-0]=arguments[s];if(r)throw Error('Already called: .on("'+t.event+'") '+i+"th arg");r=!0,e.dispatch(o.createResponse(t,i,n))}},t.prototype.pub=function(t){var i=t.event,e=t.args;if(i){var r=!1;if(this.onevent&&(r=!!this.onevent(i,e)),!r){var n;if(this.api&&(n=this.api.get(i)),n)n.apply(this,e);else{var s=this.subs[i];s&&s.apply(null,e),s=this.subs["*"],s&&s.apply(null,[i].concat(e))}}}},t.prototype.sendData=function(t){this.send(t)},t.prototype.dispatch=function(t){var i=this;t.hasCallbacks()&&(this.frame[t.id]=t,this.timer[t.id]=setTimeout(function(){delete i.frame[t.id]},t.timeout+this.latency));var e=t.serialize();this.sendData(e)},t.prototype.processResponse=function(t){var i=this.frame[t.rid];if(i&&(i.processResponse(t),!i.hasCallbacks())){var e=i.id;delete this.frame[e];var r=this.timer[e];r&&clearTimeout(r),delete this.timer[e]}},t.prototype.procMsg=function(t){var i=new a;try{i.unserialize(t,this.genCallack.bind(this))}catch(e){return void this.onerror(e)}i.isResponse()?this.processResponse(i):this.pub(i)},t.prototype.setApi=function(t){return this.api=t,this},t.prototype.onmessage=function(t){if("object"==typeof t)if(t instanceof Array)for(var i=0,e=t;i<e.length;i++){var r=e[i];this.procMsg(r)}else this.procMsg(t)},t.prototype.on=function(t,i){return this.subs[t]=i,this},t.prototype.emit=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var r=new o(i,t);return this.dispatch(r),this},t}();i.Router=h;var u=function(t){function i(){t.apply(this,arguments),this.cycle=10,this.timer=0,this.buffer=[]}return r(i,t),i.prototype.flush=function(){this.send(this.buffer),this.buffer=[]},i.prototype.sendData=function(t){this.buffer.push(t),this.startTimer()},i.prototype.startTimer=function(){var t=this;this.timer||(this.timer=setTimeout(function(){t.timer=0,t.flush()},this.cycle))},i}(h);i.RouterBuffered=u;var f=function(){function t(){this.methods={}}return t.prototype.add=function(t){return this.methods=n.extend(this.methods,t),this},t.prototype.get=function(t){return this.methods[t]},t}();i.Api=f},function(t,i){"use strict";function e(t,i){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if("object"==typeof i)for(var s in i)t[s]=i[s];return r.length?e.apply(null,[t].concat(r)):t}i.extend=e}]);
//# sourceMappingURL=dist/nmsg-rpc.min.js.map