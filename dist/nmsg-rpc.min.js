!function(t){function i(e){if(r[e])return r[e].exports;var s=r[e]={exports:{},id:e,loaded:!1};return t[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}var r={};return i.m=t,i.c=r,i.p="",i(0)}([function(t,i,r){var e,s,n,o=this;"undefined"!=typeof window&&(o=window),"undefined"!=typeof self&&(o=self),function(r,o){s=[],e=o,n="function"==typeof e?e.apply(i,s):e,!(void 0!==n&&(t.exports=n)),r.nmsg=r.nmsg||{},r.nmsg.rpc=o()}(o,function(){return r(1)})},function(t,i,r){"use strict";var e=this&&this.__extends||function(t,i){function r(){this.constructor=t}for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)},s=r(2),n=function(){function t(){this.data=null,this.id=0,this.event="",this.args=[],this.callbacks=[],this.rid=0,this.func=0,this.timeout=t.timeout}return t.getNextId=function(){return t.id=t.id%1e9+1},t.prototype.hasCallbacks=function(){for(var t=0,i=this.args;t<i.length;t++){var r=i[t];if("function"==typeof r)return!0}return!1},t.prototype.isResponse=function(){return!!this.rid},t.id=0,t.timeout=5e3,t}();i.Frame=n;var o=function(t){function i(i,r){void 0===i&&(i=[]),void 0===r&&(r=""),t.call(this),this.id=n.getNextId(),this.event=r,this.args=i}return e(i,t),i.createResponse=function(t,r,e){var s=new i(e);return s.rid=t.id,s.func=r,s},i.prototype.processResponse=function(t){var i=t.func,r=this.args[i];"function"==typeof r&&(this.args[i]=null,r.apply(null,t.args))},i.prototype.serialize=function(){var t={i:this.id,e:this.event};if(this.args.length){t.a=[];for(var i=[],r=0;r<this.args.length;r++){var e=this.args[r];"function"==typeof e?(i.push(r),this.callbacks.push(e)):(t.a.push(e),n.timeout!=this.timeout&&(t.t=this.timeout/1e3))}i.length&&(t.c=i)}return this.rid&&(t.r=this.rid,t.f=this.func),this.data=t,this.data},i}(n);i.FrameOutgoing=o;var a=function(t){function i(){t.apply(this,arguments)}return e(i,t),i.prototype.unserialize=function(t,i){if(this.data=t,"number"!=typeof t.i)throw Error("Error parsing id");if(this.id=t.i,t.t){if("number"!=typeof t.t)throw Error("Error parsing timeout");this.timeout=t.t}else this.timeout=n.timeout;if(this.args=[],t.a){if(!(t.a instanceof Array))throw Error("Error parsing arguments");for(var r=0,e=t.a;r<e.length;r++){var s=e[r];this.args.push(s)}}else t.a=[];if(this.callbacks=[],t.c){if(!(t.c instanceof Array))throw Error("Error parsing callbacks");for(var o=0,a=t.c;o<a.length;o++){var h=a[o],u=i(this,h);this.callbacks.push(u),this.args.splice(h,0,u)}}if(this.event="",this.rid=0,this.func=0,t.e){if("string"!=typeof t.e)throw Error("Error parsing event");this.event=t.e}else if(t.r){if("number"!=typeof t.r)throw Error("Error parsing resposne id");if(this.rid=t.r,"number"!=typeof t.f)throw Error("Error parsing reponse position");this.func=t.f}},i}(n);i.FrameIncoming=a;var h=function(){function t(t){var i=this;this.latency=500,this.frame={},this.timer={},this.api=null,this.subs={},t&&(this.send=t.send.bind(t),t.onmessage=function(t){i.onmessage(t)})}return t.prototype.genCallack=function(t,i){var r=this;return function(){for(var e=[],s=0;s<arguments.length;s++)e[s-0]=arguments[s];r.dispatch(o.createResponse(t,i,e))}},t.prototype.getSubList=function(t){return this.subs[t]||(this.subs[t]=[]),this.subs[t]},t.prototype.pub=function(t){var i=t.event;if(i){var r,e=t.args;if(this.api&&(r=this.api.get(i)),r)r.apply(this,e);else{for(var s=this.getSubList(i),n=0,o=s;n<o.length;n++){var a=o[n];a.apply(null,e)}s=this.getSubList("*");for(var h=0,u=s;h<u.length;h++){var a=u[h];a.apply(null,[i].concat(e))}}}},t.prototype.sendData=function(t){this.send(t)},t.prototype.dispatch=function(t){var i=this;t.hasCallbacks()&&(this.frame[t.id]=t,this.timer[t.id]=setTimeout(function(){delete i.frame[t.id]},t.timeout+this.latency));var r=t.serialize();this.sendData(r)},t.prototype.processResponse=function(t){var i=this.frame[t.rid];if(i&&(i.processResponse(t),!i.hasCallbacks())){var r=i.id;delete this.frame[r];var e=this.timer[r];e&&clearTimeout(e),delete this.timer[r]}},t.prototype.setApi=function(t){return this.api=t,this},t.prototype.onmessage=function(t){var i=new a;i.unserialize(t,this.genCallack.bind(this)),i.isResponse()?this.processResponse(i):this.pub(i)},t.prototype.on=function(t,i){var r=this.getSubList(t);return r.push(i),this},t.prototype.emit=function(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var e=new o(i,t);return this.dispatch(e),this},t}();i.Router=h;var u=function(t){function i(){t.apply(this,arguments),this.cycle=5,this.timer=0,this.buffer=[]}return e(i,t),i.prototype.flush=function(){var t={b:this.buffer};this.send(t),this.buffer=[]},i.prototype.sendData=function(t){this.buffer.push(t),this.startTimer()},i.prototype.startTimer=function(){var t=this;this.timer||(this.timer=setTimeout(function(){t.timer=0,t.flush()},this.cycle))},i.prototype.onmessage=function(i){if("object"==typeof i)if(i.b){if(!(i.b instanceof Array))return;for(var r=0,e=i.b;r<e.length;r++){var s=e[r];t.prototype.onmessage.call(this,s)}}else t.prototype.onmessage.call(this,i)},i}(h);i.RouterBuffered=u;var f=function(){function t(){this.methods={}}return t.prototype.add=function(t){return this.methods=s.extend(this.methods,t),this},t.prototype.get=function(t){return this.methods[t]},t}();i.Api=f},function(t,i){"use strict";function r(t,i){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];if("object"==typeof i)for(var n in i)t[n]=i[n];return e.length?r.apply(null,[t].concat(e)):t}i.extend=r}]);
//# sourceMappingURL=dist/nmsg-rpc.min.js.map