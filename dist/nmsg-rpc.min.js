!function(t){function r(e){if(i[e])return i[e].exports;var s=i[e]={exports:{},id:e,loaded:!1};return t[e].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}var i={};return r.m=t,r.c=i,r.p="",r(0)}([function(t,r,i){var e,s,n,o=this;"undefined"!=typeof window&&(o=window),"undefined"!=typeof self&&(o=self),function(i,o){s=[],e=o,n="function"==typeof e?e.apply(r,s):e,!(void 0!==n&&(t.exports=n)),i.nmsg=i.nmsg||{},i.nmsg.rpc=o()}(o,function(){return i(1)})},function(t,r,i){"use strict";var e=this&&this.__extends||function(t,r){function i(){this.constructor=t}for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)},s=i(2),n=function(){function t(){this.data=null,this.id=0,this.event="",this.args=[],this.callbacks=[],this.rid=0,this.func=0,this.timeout=t.timeout}return t.getNextId=function(){return t.id=t.id%1e9+1},t.prototype.hasCallbacks=function(){for(var t=0,r=this.args;t<r.length;t++){var i=r[t];if("function"==typeof i)return!0}return!1},t.prototype.isResponse=function(){return!!this.rid},t.id=0,t.timeout=5e3,t}();r.Frame=n;var o=function(t){function r(r,i){void 0===r&&(r=[]),void 0===i&&(i=""),t.call(this),this.id=n.getNextId(),this.event=i,this.args=r}return e(r,t),r.createResponse=function(t,i,e){var s=new r(e);return s.rid=t.id,s.func=i,s},r.prototype.processResponse=function(t){var r=t.func,i=this.args[r];"function"==typeof i&&(this.args[r]=null,i.apply(null,t.args))},r.prototype.serialize=function(){var t={i:this.id,e:this.event};if(this.args.length){t.a=[];for(var r=[],i=0;i<this.args.length;i++){var e=this.args[i];"function"==typeof e?(r.push(i),this.callbacks.push(e)):(t.a.push(e),n.timeout!=this.timeout&&(t.t=this.timeout/1e3))}r.length&&(t.c=r)}return this.rid&&(t.r=this.rid,t.f=this.func),this.data=t,this.data},r}(n);r.FrameOutgoing=o;var a=function(t){function r(){t.apply(this,arguments)}return e(r,t),r.prototype.unserialize=function(t,r){if(this.data=t,"number"!=typeof t.i)throw Error("Error parsing id");if(this.id=t.i,t.t){if("number"!=typeof t.t)throw Error("Error parsing timeout");this.timeout=t.t}else this.timeout=n.timeout;if(this.args=[],t.a){if(!(t.a instanceof Array))throw Error("Error parsing arguments");for(var i=0,e=t.a;i<e.length;i++){var s=e[i];this.args.push(s)}}else t.a=[];if(this.callbacks=[],t.c){if(!(t.c instanceof Array))throw Error("Error parsing callbacks");for(var o=0,a=t.c;o<a.length;o++){var h=a[o],u=r(this,h);this.callbacks.push(u),this.args.splice(h,0,u)}}if(this.event="",this.rid=0,this.func=0,t.e){if("string"!=typeof t.e)throw Error("Error parsing event");this.event=t.e}else if(t.r){if("number"!=typeof t.r)throw Error("Error parsing resposne id");if(this.rid=t.r,"number"!=typeof t.f)throw Error("Error parsing reponse position");this.func=t.f}},r}(n);r.FrameIncoming=a;var h=function(){function t(){this.latency=500,this.frame={},this.timer={},this.onerror=function(){},this.api=null,this.subs={}}return t.prototype.genCallack=function(t,r){var i=this,e=!1;return function(){for(var s=[],n=0;n<arguments.length;n++)s[n-0]=arguments[n];if(e)throw Error('Already called: .on("'+t.event+'") '+r+"th arg");e=!0,i.dispatch(o.createResponse(t,r,s))}},t.prototype.pub=function(t){var r=t.event;if(r){var i,e=t.args;if(this.api&&(i=this.api.get(r)),i)i.apply(this,e);else{var s=this.subs[r];s&&s.apply(null,e),s=this.subs["*"],s&&s.apply(null,[r].concat(e))}}},t.prototype.sendData=function(t){this.send(t)},t.prototype.dispatch=function(t){var r=this;t.hasCallbacks()&&(this.frame[t.id]=t,this.timer[t.id]=setTimeout(function(){delete r.frame[t.id]},t.timeout+this.latency));var i=t.serialize();this.sendData(i)},t.prototype.processResponse=function(t){var r=this.frame[t.rid];if(r&&(r.processResponse(t),!r.hasCallbacks())){var i=r.id;delete this.frame[i];var e=this.timer[i];e&&clearTimeout(e),delete this.timer[i]}},t.prototype.setApi=function(t){return this.api=t,this},t.prototype.onmessage=function(t){var r=new a;try{r.unserialize(t,this.genCallack.bind(this))}catch(i){return void this.onerror(i)}r.isResponse()?this.processResponse(r):this.pub(r)},t.prototype.on=function(t,r){return this.subs[t]=r,this},t.prototype.emit=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var e=new o(r,t);return this.dispatch(e),this},t}();r.Router=h;var u=function(t){function r(){t.apply(this,arguments),this.cycle=10,this.timer=0,this.buffer=[]}return e(r,t),r.prototype.flush=function(){this.send(this.buffer),this.buffer=[]},r.prototype.sendData=function(t){this.buffer.push(t),this.startTimer()},r.prototype.startTimer=function(){var t=this;this.timer||(this.timer=setTimeout(function(){t.timer=0,t.flush()},this.cycle))},r.prototype.onmessage=function(r){if("object"==typeof r)if(r instanceof Array)for(var i=0,e=r;i<e.length;i++){var s=e[i];t.prototype.onmessage.call(this,s)}else t.prototype.onmessage.call(this,r)},r}(h);r.RouterBuffered=u;var f=function(){function t(){this.methods={}}return t.prototype.add=function(t){return this.methods=s.extend(this.methods,t),this},t.prototype.get=function(t){return this.methods[t]},t}();r.Api=f},function(t,r){"use strict";function i(t,r){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];if("object"==typeof r)for(var n in r)t[n]=r[n];return e.length?i.apply(null,[t].concat(e)):t}r.extend=i}]);
//# sourceMappingURL=dist/nmsg-rpc.min.js.map